if(!Array.prototype.push){Array.prototype.push=function(){var b=this.length;for(var a=0;a<arguments.length;a++){this[b+a]=arguments[a]}return this.length}}if(!Function.prototype.apply){Function.prototype.apply=function(object,parameters){var parameterStrings=[];if(!object){object=window}if(!parameters){parameters=[]}for(var i=0;i<parameters.length;i++){parameterStrings[i]="parameters["+i+"]"}object.__apply__=this;var result=eval("object.__apply__("+parameterStrings.join(", ")+")");object.__apply__=null;return result}}var ajax={};ajax.x=function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return new XMLHttpRequest()}}};ajax.send=function(b,f,e,d,c){var a=ajax.x();a.open(e,b,c);a.onreadystatechange=function(){if(a.readyState==4){f(a.responseText)}};if(e=="POST"){a.setRequestHeader("Content-type","application/x-www-form-urlencoded")}a.send(d)};ajax.get=function(a,e,f,c){var d=[];for(var b in e){d.push(encodeURIComponent(b)+"="+encodeURIComponent(e[b]))}ajax.send(a+"?"+d.join("&"),f,"GET",null,c)};ajax.post=function(a,e,f,c){var d=[];for(var b in e){d.push(encodeURIComponent(b)+"="+encodeURIComponent(e[b]))}ajax.send(a,f,"POST",d.join("&"),c)};var JSValidator=function(b,c,d,a){this.name=b;this.objectName=c;this.config=a;this.rules=d;this.form=this._findForm(b)};JSValidator.defaultConf={errorLocalMessageTemplate:"<span class='{{class}}'>{{message}}</span>",errorGlobalMessageTemplate:"<span class='{{class}}'>{{message}}</span>",ajaxValidateFieldURL:0,ajaxValidateFieldParams:function(d,c,a,b){return{objectName:d,fieldName:c,fieldValue:a,constraints:b}}};JSValidator.Utils={_bindEvent:function(a,d,c,b){if(a.addEventListener){a.addEventListener(d,c,b)}else{if(a.attachEvent){a.attachEvent("on"+d,c)}}},_bindFieldToEvent:function(f,e,g,d){var c=function(h){g(h,f)};for(var a=0;a<f.fieldElements.length;a++){var b=f.fieldElements[a];this._bindEvent(b,e,c,d)}},_getAjaxableInRules:function(b){var a=[];b.forEach(function(c){if(c.params.ajaxable){a.push(c)}});return a},_getDefaultInRules:function(b){var a=[];b.forEach(function(c){if(!c.params.ajaxable){a.push(c)}});return a},_buildErrorLine:function(c,d,b){if(!d.params.message){return""}var a=b?c.validator._getProp("errorGlobalMessageTemplate"):c.validator._getProp("errorLocalMessageTemplate");a=a.replace("{{class}}",this._buildErrorClassName(c,d.constraint));a=a.replace("{{message}}",d.params.message);return a},_buildErrorClassName:function(b,a){return b.name+"_"+a+"_error"},_buildRuleViolation:function(a){return{constraint:a.validationFunction,params:JSON.parse(JSON.stringify(a.params))}}};JSValidator.prototype={_findForm:function(a){var c=document.getElementById(a);if(!c||c.tagName.toLowerCase()!="form"){c=document.getElementById(a+"JSValidator");if(!c||c.tagName.toLowerCase()!="script"){throw"unable to find form with ID '"+a+"' or script element with ID '"+a+"JSValidator'"}}var b=c;while(c&&c.tagName.toLowerCase()!="form"){c=c.parentNode}if(!c){throw"unable to find FORM element enclosing element with ID '"+b.id+"'"}return new JSValidator.Form(c,this)},getForm:function(){return this.form},getFieldWithName:function(a){return this.form.getFieldWithName(a)},getFields:function(){return this.form.getFields()},_getProp:function(a){if(this.config&&this.config[a]){return this.config[a]}else{return JSValidator.defaultConf[a]}}};JSValidator.Form=function(b,a){this.formElement=b;this.validator=a;this.fields=this._findFields()};JSValidator.Form.prototype={getValue:function(a){return this.getFieldWithName(a).getValue()},getFieldWithName:function(c){var a=this.getFields();for(var b=0;b<a.length;b++){if(a[b].name==c){return a[b]}}return null},getFields:function(){return this.fields},_findFields:function(){var b=this;var a=[];var f=this.formElement.elements;var c=[];for(var d=0;d<f.length;d++){if(f[d].tagName.toLowerCase()!="fieldset"&&f[d].name&&!c[f[d].name]){c[f[d].name]=true;var e=new JSValidator.Field(document.getElementsByName(f[d].name),b.validator);if(e._hasValidationRules()){a.push(e)}}}return a},bindValidationToSubmit:function(){var b=this;b.actions=new JSValidator.Form.Actions();var a=b.getFields();a.forEach(function(c){c.bindValidationToEvent("submit")});JSValidator.Utils._bindEvent(b.formElement,"submit",function(c){b._doAction(c,null,"preSubmitValidationProcess");var d=true;b.getFields().forEach(function(e){e._doValidateField(c,e,function(g){var f=[];if(g.length>0){d=false;f.push({field:e.name,ruleViolations:g})}b._doAction(c,f,"postSubmitValidationProcess");if(f.length>0){c.preventDefault()}})})},false);return b.actions},_doAction:function(c,a,b){if(this.actions[b]){this.actions[b](c,a)}},_addGlobalProcess:function(c,e){var b=this;var a=b.getFields();var d=new JSValidator.Field.Actions();d[e](c);a.forEach(function(g){var f=g._getActionsForEventType("all");if(f){f[e](c)}else{g._addActionsToEventType("all",d)}})},addFieldsPreValidationProcess:function(a){this._addGlobalProcess(a,"addPreValidationProcess");return this},addFieldsPostValidationBeforeMessageProcess:function(a){this._addGlobalProcess(a,"addPostValidationBeforeMessageProcess");return this},addFieldsPostValidationAfterMessageProcess:function(a){this._addGlobalProcess(a,"addPostValidationAfterMessageProcess");return this}};JSValidator.Form.Actions=function(){};JSValidator.Form.Actions.prototype={addPreSubmitValidationProcess:function(a){this.preSubmitValidationProcess=a;return this},addPostSubmitValidationProcess:function(a){this.postSubmitValidationProcess=a;return this}};JSValidator.Field=function(b,a){this.validator=a;this.name=b[0].name;this.tagName=b[0].tagName.toLowerCase();this.type=b[0].type.toLowerCase();this.fieldElements=b;this.actions=[];if(JSValidator.Field.ValueGetters[this.tagName]){this.getValue=JSValidator.Field.ValueGetters[this.tagName]}else{if(this.tagName=="input"){switch(this.type){case"submit":case"hidden":case"password":case"text":this.getValue=JSValidator.Field.ValueGetters.textarea;break;case"checkbox":this.getValue=JSValidator.Field.ValueGetters.checkbox;break;case"radio":this.getValue=JSValidator.Field.ValueGetters.radio;break;default:throw"unexpected input field type '"+this.type+"'"}}else{throw"unexpected form field tag name '"+this.tagName+"'"}}};JSValidator.Field.prototype={bindValidationToEvent:function(c){var a=this;var d=new JSValidator.Field.Actions();var b=0;c.trim().split(",").forEach(function(e){b=e;a._addActionsToEventType(e,d);JSValidator.Utils._bindFieldToEvent(a,e,a._initFieldValidation,false)});if(b){return a._getActionsForEventType(b)}},_executeConditions:function(c){var a=this;try{if(a._getActionsForEvent(c).conditions.length>0){console.log("Execute validation conditions");a._getActionsForEvent(c).conditions.forEach(function(d){if(!d(a)){throw"conditionFailed"}})}}catch(b){if(b=="conditionFailed"){console.log("Conditions failed");return false}}return true},_getFieldRules:function(){var a=this;var d=[];for(var b=0;b<a.validator.rules.length;b++){if(a.validator.rules[b].field==a.name){var c=a.validator.rules[b];c.form=a.validator.form;d.push(c)}}return d},_hasValidationRules:function(){return this._getFieldRules().length>0},_doValidateRules:function(c){var a=this;var b=this._getFieldRules();if(b.length>0){a._validateRules(b,c)}else{console.log('Unable to find validation rules for field "'+a.name+'"')}},_validateRules:function(i,c){var h=this;var e=[];var g=JSValidator.Utils._getDefaultInRules(i);g.forEach(function(j){console.log("Validating rule ["+j.validationFunction+"] for field ["+j.field+"]");if(!j.validate(this)){console.log("Failed");e.push(JSValidator.Utils._buildRuleViolation(j))}else{console.log("Passed")}});var f=h.validator._getProp("ajaxValidateFieldURL");var a=JSValidator.Utils._getAjaxableInRules(i);if(f&&a.length>0){var b=[];a.forEach(function(j){b.push(j.validationFunction)});var d=h.validator._getProp("ajaxValidateFieldParams")(h.validator.objectName,a[0].field,h.getValue(),b.join(","));console.log("AJAX Validating rules for field ["+a[0].field+"]");ajax.post(f,d,function(j){if(j){e=e.concat(JSON.parse(j));if(e.length>0){console.log("Failed")}else{console.log("Passed")}}if(c){c(e)}})}else{if(!f&&a.length>0){console.log("Unable to validates rules in AJAX, no service URL provide in validator config")}else{if(c){c(e)}}}},_initFieldValidation:function(a,b){if(b._getActionsForEvent(a).validationTimeoutDelay&&!isNaN(b._getActionsForEvent(a).validationTimeoutDelay)){clearInterval(b._getActionsForEvent(a).validationTimeout);b._getActionsForEvent(a).validationTimeout=setTimeout(function(){b._doValidateField(a,b)},b._getActionsForEvent(a).validationTimeoutDelay)}else{b._doValidateField(a,b)}},_doAction:function(d,e,b,c){var a=e._getActionsForEventType("all");if(a&&a[c]){a[c](d,e,b)}if(e._getActionsForEvent(d)[c]){e._getActionsForEvent(d)[c](d,e,b)}},_doValidateField:function(a,b,c){console.log("Start validating field:"+b.name);if(!b._hasValidationRules()||!b._executeConditions(a)){return true}b._doAction(a,b,null,"preValidationProcess");b._doValidateRules(function(d){b._doAction(a,b,d,"postValidationProcessBeforeMessage");b._updateErrorMessages(d);b._doAction(a,b,d,"postValidationProcessAfterMessage");if(c){c(d)}})},_updateErrorMessages:function(a){this._updateLocalErrorMessages(a);this._updateGlobalErrorMessages(a)},_updateGlobalErrorMessages:function(c){var a=this;var b=document.getElementById(a.validator.form.formElement.getAttribute("id")+"_errors");if(b){var e=b.cloneNode(true);var d=a._getFieldRules();d.forEach(function(f){var g=e.getElementsByClassName(JSValidator.Utils._buildErrorClassName(a,f.validationFunction));if(g.length>0){e.removeChild(g[0])}});c.forEach(function(f){e.innerHTML+=JSValidator.Utils._buildErrorLine(a,f,true)});b.parentNode.replaceChild(e,b)}},_updateLocalErrorMessages:function(c){var a=this;var b=document.getElementById(a.name+"_error");if(b){var d=b.cloneNode(false);c.forEach(function(e){d.innerHTML+=JSValidator.Utils._buildErrorLine(a,e,false)});b.parentNode.replaceChild(d,b)}},_addActionsToEventType:function(a,b){this.actions[a]=b},_getActionsForEvent:function(a){return this._getActionsForEventType(a.type)},_getActionsForEventType:function(a){return this.actions[a]}};JSValidator.Field.Actions=function(){};JSValidator.Field.Actions.prototype={addValidationCondition:function(a){if(!this.conditions){this.conditions=[]}this.conditions.push(a);return this},addPreValidationProcess:function(a){this.preValidationProcess=a;return this},addPostValidationBeforeMessageProcess:function(a){this.postValidationProcessBeforeMessage=a;return this},addPostValidationAfterMessageProcess:function(a){this.postValidationProcessAfterMessage=a;return this},setValidationDelay:function(a){this.validationTimeoutDelay=a;return this}};JSValidator.Field.ValueGetters={radio:function(){var b=null;for(var a=0;a<this.fieldElements.length;a++){if(this.fieldElements[a].checked){b=this.fieldElements[a].value}}return b},checkbox:function(){var b=[];for(var a=0;a<this.fieldElements.length;a++){if(this.fieldElements[a].checked){b.push(this.fieldElements[a].value)}}return b},textarea:function(){if(this.fieldElements.length==1){return this.fieldElements[0].value}else{if(this.fieldElements.length>1){var c=[];for(var a=0;a<this.fieldElements.length;a++){var b=this.fieldElements[a];c.push(b.value)}return c}}return null},select:function(){var c=null;if(this.fieldElements[0].type=="select-one"){c=this.fieldElements[0].value}else{if(this.fieldElements[0].type=="select-multiple"){c=[];for(var a=0;a<this.fieldElements[0].options.length;a++){var b=this.fieldElements[0].options[a];if(b.selected){c.push(b.value)}}}}return c}};JSValidator.Rule=function(b,a,c){this.field=b;this.params=c;this.validationFunction=a};JSValidator.Rule.prototype={validate:function(a){var b=this[this.validationFunction];if(!b||typeof b!="function"){return true}return b(this.getPropertyValue(this.field),this.params,this.field,a.config)},getErrorMessage:function(){return(this.params.message||"Invalid value for "+this.field)},getPropertyValue:function(a,b){return this.form.getValue(a)},_assertHasLength:function(a){if(!a.length){throw"value '"+a+"' does not have length"}},_assertLength:function(b,a){this._assertHasLength(b);if(b.length!=a){throw"value's length != '"+a+"'"}},_throwError:function(a){throw a},_makeCompatible:function(a,e){try{this._forceNumber(e);return this._forceNumber(a)}catch(b){}var c=typeof a;var d=typeof e;if(c==d){return a}else{if(c=="number"||d=="number"){return this._forceNumber(a)}else{throw"unable to convert ["+a+"] and ["+e+"] to compatible types"}}},_forceNumber:function(value){if(typeof value!="number"){try{var newValue=eval(value.toString())}catch(ex){}if(newValue&&typeof newValue=="number"){return newValue}throw"unable to convert value ["+value+"] to number"}return value},AssertFalse:function(a,b){return(a=="false")},AssertTrue:function(a,b){return(a=="true")},DecimalMax:function(c,d){var b=true;if(c){var a=new Number(c).valueOf();if(isNaN(a)){b=false}else{b=a<=new Number(d.value).valueOf()}}return b},DecimalMin:function(c,d){var b=true;if(c){var a=new Number(c).valueOf();if(isNaN(a)){b=false}else{b=a>=new Number(d.value).valueOf()}}return b},Digits:function(d,e){var c=true;if(d){var b=new Number(d).valueOf();if(isNaN(b)){c=false}else{var a=b.toString();var f=a.split(".");if(e.integer&&f[0].length>e.integer){c=false}if(c&&e.fraction&&f.length>1&&f[1].length>e.fraction){c=false}}}return c},Max:function(c,d){var b=true;if(c){var a=new Number(c).valueOf();if(isNaN(a)){b=false}else{b=a<=new Number(d.value).valueOf()}}return b},Min:function(c,d){var b=true;if(c){var a=new Number(c).valueOf();if(isNaN(a)){b=false}else{b=a>=new Number(d.value).valueOf()}}return b},NotNull:function(a,b){return(a&&a.toString().length>0)},Null:function(a,b){return(!a||a.toString().length==0)},Pattern:function(e,f){var d=true;if(e){var b=false;if(f.flag&&f.flag.length>0){for(var c=0;c<f.flag.length;c++){if(f.flag[c]=="CASE_INSENSITIVE"){b=true;break}}}var a=b?new RegExp(f.regexp,"i"):new RegExp(f.regexp);d=e.search(a)>-1}return d},Size:function(c,d){var b=true;if(c){var a=c.length;if(d.min&&a<d.min){b=false}if(b&&d.max&&a>d.max){b=false}}return b},Future:function(f,h,i,b){var d=true;if(f){var a=(b[i]&&b[i].dateFormat?b[i].dateFormat:JSValidator.DateParser.defaultFormat);try{var c=JSValidator.DateParser.parseDate(a,f);d=c&&c.getTime()>new Date().getTime()}catch(g){console.log(g)}}return d},Past:function(f,h,i,b){var d=true;if(f){var a=(b[i]&&b[i].dateFormat?b[i].dateFormat:JSValidator.DateParser.defaultFormat);try{var c=JSValidator.DateParser.parseDate(a,f);d=c&&c.getTime()<new Date().getTime()}catch(g){console.log(g)}}return d},Email:function(a,b){return(!a||a.search(JSValidator.Rule.emailPattern)>-1)},Length:function(c,d){var b=true;if(c){var a=c.toString().length;if(d.min&&a<d.min){b=false}if(b&&d.max&&a>d.max){b=false}}return b},NotEmpty:function(a,b){return(a&&a.toString().search(/\w+/)>-1)},Range:function(c,d){var b=true;if(c){var a=new Number(c).valueOf();if(isNaN(a)){b=false}else{if(d.min&&a<d.min){b=false}if(b&&d.max&&a>d.max){b=false}}}return b}};JSValidator.Rule.emailPatternAtom='[^\x00-\x1F^\\(^\\)^\\<^\\>^\\@^\\,^\\;^\\:^\\^"^\\.^\\[^\\]^\\s]';JSValidator.Rule.emailPatternDomain=JSValidator.Rule.emailPatternAtom+"+(\\."+JSValidator.Rule.emailPatternAtom+"+)*";JSValidator.Rule.emailPatternIPDomain="\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\]";JSValidator.Rule.emailPattern=new RegExp("^"+JSValidator.Rule.emailPatternAtom+"+(\\."+JSValidator.Rule.emailPatternAtom+"+)*@("+JSValidator.Rule.emailPatternDomain+"|"+JSValidator.Rule.emailPatternIPDomain+")$","i");JSValidator.DateParser={defaultFormat:"M/d/y",formatChars:{d:{regexp:"\\d{1,2}"},m:{regexp:"\\d{1,2}"},M:{regexp:"\\d{1,2}"},a:{regexp:"[aApP][mM]+"},y:{regexp:"\\d{1,4}"},h:{regexp:"\\d{1,2}"},H:{regexp:"\\d{1,2}"},s:{regexp:"\\d{1,2}"}},parseDate:function(p,t){var m=null;if(!p||p.search(/\w/)<0){throw ("date format must not be blank")}if(p.search(/y/)<0){throw ('date format must at least contain year character ("y")')}if(p.indexOf("h")>-1&&p.indexOf("a")<0){throw ('date format must contain AM/PM ("a") if using 12-hour hours ("h")')}if(p.indexOf("H")>-1&&p.indexOf("a")>-1){throw ('date format must not contain AM/PM ("a") if using 24-hour hours ("H")')}if(!t||t.search(/\w/)<0){throw ("date value must not be blank")}var j;var d={};var o=1;for(var q=0;q<p.length;q++){var e=p.charAt(q);for(j in this.formatChars){if(e==j){if(d[j]){throw ("date format must not contain more than one of the same format character")}d[j]=o++}}}var c=p;for(j in this.formatChars){c=c.replace(j,"("+this.formatChars[j].regexp+")")}c=new RegExp(c);var b=t.match(c);if(!b){return null}var g=Math.max(0,b[d.y]||0);var l=Math.max(0,(b[d.M]||0)-1);var a=Math.max(1,b[d.d]||0);var f=b[d.h];var n=b[d.a];var s=b[d.H];var r;if(f){r=f%12;if(n.toLowerCase().indexOf("p")>-1){r+=12}}else{r=s||0}r=Math.max(0,r);var k=Math.max(0,b[d.m]||0);var h=Math.max(0,b[d.s]||0);m=new Date(g,l,a,r,k,h);return m}};